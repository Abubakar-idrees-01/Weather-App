{% extends "weather/base.html" %}

{% block title %}SkyCast | Premium Weather{% endblock %}

{% block content %}
<style>
    :root {
        --glass-bg: rgba(255, 255, 255, 0.1);
        --glass-border: rgba(255, 255, 255, 0.2);
        --text-main: #ffffff;
        --accent-blue: #4facfe;
        --accent-secondary: #00f2fe;
        --blur: 20px;
        --bg-gradient: linear-gradient(-45deg, #0f2027, #203a43, #2c5364);
    }

    /* Light Mode Variables */
    [data-theme="light"] {
        --glass-bg: rgba(255, 255, 255, 0.6);
        --glass-border: rgba(0, 0, 0, 0.1);
        --text-main: #2d3436;
        --bg-gradient: linear-gradient(-45deg, #e0c3fc, #8ec5fc, #f1f2f6);
    }

    body {
        margin: 0;
        min-height: 100vh;
        background: var(--bg-gradient);
        background-size: 400% 400%;
        animation: gradientBG 15s ease infinite;
        color: var(--text-main);
        transition: all 0.5s ease;
        font-family: 'Inter', sans-serif;
    }

    @keyframes gradientBG {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
    }

    .dashboard-container {
        padding: 2rem 1rem;
        max-width: 1200px;
        margin: auto;
    }

    .glass-card {
        background: var(--glass-bg);
        backdrop-filter: blur(var(--blur));
        -webkit-backdrop-filter: blur(var(--blur));
        border: 1px solid var(--glass-border);
        border-radius: 32px;
        box-shadow: 0 12px 40px 0 rgba(0, 0, 0, 0.15);
        transition: transform 0.3s ease;
    }

    /* Theme Toggle */
    .theme-switch {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 1000;
        cursor: pointer;
        padding: 10px;
        border-radius: 50%;
        background: var(--glass-bg);
        border: 1px solid var(--glass-border);
    }

    .search-group .form-control {
        background: rgba(255, 255, 255, 0.1) !important;
        border: 1px solid var(--glass-border) !important;
        color: var(--text-main) !important;
        border-radius: 18px;
        padding: 16px 28px;
    }

    .btn-action {
        background: linear-gradient(135deg, var(--accent-blue), var(--accent-secondary));
        color: white;
        border: none;
        border-radius: 18px;
        font-weight: 700;
        box-shadow: 0 4px 15px rgba(79, 172, 254, 0.4);
    }

    .stat-box {
        background: rgba(255, 255, 255, 0.05);
        padding: 1.5rem;
        border-radius: 24px;
        border: 1px solid var(--glass-border);
        transition: all 0.3s ease;
    }

    .stat-box:hover { background: rgba(255, 255, 255, 0.1); }

    /* Responsive Grid for Forecast */
    .forecast-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
        gap: 1.5rem;
    }

    .daily-card {
        background: var(--glass-bg);
        border: 1px solid var(--glass-border);
        border-radius: 26px;
        padding: 24px 15px;
        text-align: center;
        transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    .daily-card:hover {
        transform: scale(1.05);
        box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    }

    #loader { display: none; }
</style>

<div class="theme-switch" onclick="toggleTheme()">
    <span id="theme-icon">ðŸŒ™</span>
</div>

<div class="dashboard-container">
    <div class="glass-card p-4 mb-5">
        <form method="POST" id="weatherForm">
            {% csrf_token %}
            <div class="row g-3">
                <div class="col-md-9">
                    <input type="text" class="form-control" name="city" placeholder="Search for a city..." required>
                </div>
                <div class="col-md-3">
                    <button type="submit" class="btn btn-action w-100 h-100 py-3">Update Forecast</button>
                </div>
            </div>
            <div id="loader" class="text-center mt-3">
                <div class="spinner-grow text-info" role="status"></div>
                <p class="mt-2 small">Scanning Atmosphere...</p>
            </div>
        </form>
    </div>

    {% if error %}
    <div class="alert glass-card text-center text-danger p-4 mb-5">{{ error }}</div>
    {% endif %}

    {% if weather %}
    <div class="row g-4">
        <div class="col-lg-5">
            <div class="glass-card h-100 p-5 text-center">
                <h6 class="text-uppercase opacity-75 mb-2">{{ weather.country }}</h6>
                <h1 class="display-3 fw-bold mb-4">{{ weather.city }}</h1>
                <div class="py-4">
                    <img src="https:{{ weather.icon }}" alt="Icon" style="width: 150px; filter: drop-shadow(0 0 20px rgba(0,0,0,0.1));">
                    <h1 class="display-1 fw-bold mt-3">{{ weather.temp|floatformat:0 }}Â°</h1>
                </div>
                <h3 class="fw-light opacity-75">{{ weather.condition }}</h3>
            </div>
        </div>

        <div class="col-lg-7">
            <div class="glass-card h-100 p-4">
                <div class="row g-3 text-center mb-4">
                    <div class="col-6 col-md-3">
                        <div class="stat-box">
                            <small class="opacity-75 d-block mb-1">Feels Like</small>
                            <span class="h5 fw-bold">{{ weather.feels_like|floatformat:0 }}Â°</span>
                        </div>
                    </div>
                    <div class="col-6 col-md-3">
                        <div class="stat-box">
                            <small class="opacity-75 d-block mb-1">Humidity</small>
                            <span class="h5 fw-bold">{{ weather.humidity }}%</span>
                        </div>
                    </div>
                    <div class="col-6 col-md-3">
                        <div class="stat-box">
                            <small class="opacity-75 d-block mb-1">Wind</small>
                            <span class="h5 fw-bold">{{ weather.wind|floatformat:0 }}</span>
                        </div>
                    </div>
                    <div class="col-6 col-md-3">
                        <div class="stat-box">
                            <small class="opacity-75 d-block mb-1">Pressure</small>
                            <span class="h5 fw-bold">{{ weather.pressure|floatformat:0 }}</span>
                        </div>
                    </div>
                </div>
                <div style="height: 250px;">
                    <canvas id="forecastChart"></canvas>
                </div>
            </div>
        </div>

        <div class="col-12 mt-4">
            <h4 class="mb-4 fw-bold">Daily Forecast</h4>
            <div class="forecast-grid">
                {% for day in forecast %}
                <div class="daily-card">
                    <p class="fw-bold mb-1">{{ day.date }}</p>
                    <img src="https:{{ day.icon }}" alt="Icon" style="width: 60px;">
                    <div class="mt-2">
                        <span class="fs-5 fw-bold d-block">{{ day.max_temp|floatformat:0 }}Â°</span>
                        <span class="small opacity-50">{{ day.min_temp|floatformat:0 }}Â°</span>
                    </div>
                    <p class="small mt-2 mb-0 opacity-75">{{ day.condition }}</p>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
    {% endif %}
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // Theme Toggle Logic
    function toggleTheme() {
        const body = document.body;
        const currentTheme = body.getAttribute('data-theme');
        const icon = document.getElementById('theme-icon');
        
        if (currentTheme === 'light') {
            body.removeAttribute('data-theme');
            icon.innerText = 'ðŸŒ™';
        } else {
            body.setAttribute('data-theme', 'light');
            icon.innerText = 'â˜€ï¸';
        }
    }

    // Chart logic
    {% if forecast %}
    const ctx = document.getElementById('forecastChart').getContext('2d');
    new Chart(ctx, {
        type: 'line',
        data: {
            labels: [{% for day in forecast %}"{{ day.date }}",{% endfor %}],
            datasets: [{
                data: [{% for day in forecast %}{{ day.avg_temp }},{% endfor %}],
                borderColor: '#4facfe',
                borderWidth: 4,
                tension: 0.4,
                pointRadius: 5,
                fill: true,
                backgroundColor: 'rgba(79, 172, 254, 0.1)'
            }]
        },
        options: {
            maintainAspectRatio: false,
            plugins: { legend: { display: false } },
            scales: {
                y: { display: false },
                x: { ticks: { color: 'gray' }, grid: { display: false } }
            }
        }
    });
    {% endif %}

    document.getElementById('weatherForm').onsubmit = () => {
        document.getElementById('loader').style.display = 'block';
    };
</script>
{% endblock %}